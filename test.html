<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test</title>
</head>
<body>

<h1>Look at the prompts</h1>
<div id="test">
    <p>Hello</p>
</div>

<script type="application/plang">
    node = $("div#test")
    node.listen("click", func(event) {
        say "Hi"
    })

</script>


<div id="pl-model" style="display:none;top:0;left:0;height: 100vh;width: 100vw;position: absolute;z-index: 99;align-items: center;justify-content: center;background-color: rgba(0, 0, 0, 0.8)"
     onclick="closeModel()">
    <div id="pl-model-body" style="background-color: #393939;color:#cecece;font-family: monospace;font-size: 1.25rem;padding: 0.75rem;overflow-x: auto"
    onclick="event.stopPropagation()">

    </div>
</div>
<script>
    const model = document.getElementById('pl-model');
    const body = document.getElementById('pl-model-body');
    function openModel(text) {
        body.innerHTML = text;
        model.style.display = "flex";
    }

    function modelOpen() {
        return model.style.display === 'flex';
    }

    function closeModel() {
        model.style.display = "none";
        if (buffer.length > 0) {
            openModel(buffer.shift());
        }
    }

    function replace(source, pick, repl) {
        return source.split(pick).join(repl);
    }

    let content = [];
    let buffer = [];
    // js custom model
    window.extern = {
        print(message) {
            // TODO: This have a scripting vulnerability
            content.push(`<span>${replace(replace(message, ' ', '&nbsp;'), '<span\\', '<span ')}</span>`);
        },
        flush() {
            if (content.length === 0) {
                return;
            }
            const text = content.join('<br/>');
            buffer.push(replace(text, '\n', '<br/>'));
            content = [];
            if (modelOpen()) {
                return;
            }
            openModel(buffer.shift());
        }
    }
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script>
<script src="out/index.js"></script>
<script>require(['inout/otherInout', 'browser/index']);</script>
</body>
</html>
